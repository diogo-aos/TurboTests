{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://turbotests.example.com/schemas/scores.json",
  "title": "Scores Schema",
  "description": "Scored test results with grades and statistics",
  "type": "object",
  "required": ["version", "scoring_metadata", "student_results"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version for compatibility tracking",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0"
    },
    "scoring_metadata": {
      "type": "object",
      "description": "Metadata about the scoring process",
      "required": ["scoring_timestamp", "scorer_version"],
      "properties": {
        "scoring_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when scoring was performed"
        },
        "scorer_version": {
          "type": "string",
          "description": "Version of the scorer tool used"
        },
        "scoring_model": {
          "type": "string",
          "description": "Scoring model used",
          "enum": ["basic_correct_incorrect", "partial_credit", "rubric_based", "curved"]
        },
        "test_info": {
          "type": "object",
          "description": "Information about the test",
          "properties": {
            "title": {
              "type": "string"
            },
            "date": {
              "type": "string",
              "format": "date"
            },
            "total_points": {
              "type": "number",
              "minimum": 0
            }
          }
        }
      }
    },
    "student_results": {
      "type": "array",
      "description": "Scoring results for each student",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["student_id", "version_id", "question_scores", "summary"],
        "properties": {
          "student_id": {
            "type": "string",
            "description": "Student identifier"
          },
          "student_name": {
            "type": "string",
            "description": "Student name (if available)"
          },
          "version_id": {
            "type": "string",
            "description": "Test version taken"
          },
          "scan_reference": {
            "type": "string",
            "description": "Reference to source scan file"
          },
          "question_scores": {
            "type": "array",
            "description": "Score for each question",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["question_id", "points_earned", "points_possible", "is_correct"],
              "properties": {
                "question_id": {
                  "type": "string",
                  "description": "Question identifier"
                },
                "question_number": {
                  "type": "integer",
                  "description": "Question number on test",
                  "minimum": 1
                },
                "question_type": {
                  "type": "string",
                  "enum": ["multiple_choice", "short_answer", "essay", "matching", "true_false"]
                },
                "student_answer": {
                  "description": "Student's answer",
                  "oneOf": [
                    {
                      "type": "string"
                    },
                    {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    {
                      "type": "null"
                    }
                  ]
                },
                "correct_answer": {
                  "description": "Correct answer",
                  "oneOf": [
                    {
                      "type": "string"
                    },
                    {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  ]
                },
                "points_earned": {
                  "type": "number",
                  "description": "Points earned for this question",
                  "minimum": 0
                },
                "points_possible": {
                  "type": "number",
                  "description": "Maximum points for this question",
                  "minimum": 0
                },
                "is_correct": {
                  "type": "boolean",
                  "description": "Whether answer is correct"
                },
                "partial_credit": {
                  "type": "boolean",
                  "description": "Whether partial credit was awarded",
                  "default": false
                },
                "confidence": {
                  "type": "number",
                  "description": "Confidence in extracted answer (from scan)",
                  "minimum": 0,
                  "maximum": 1
                },
                "feedback": {
                  "type": "string",
                  "description": "Feedback for this question (enterprise tier)"
                },
                "flags": {
                  "type": "array",
                  "description": "Flags for manual review or special conditions",
                  "items": {
                    "type": "string",
                    "enum": [
                      "low_confidence",
                      "no_answer",
                      "manual_review_required",
                      "multiple_answers",
                      "ambiguous"
                    ]
                  }
                }
              }
            }
          },
          "summary": {
            "type": "object",
            "description": "Summary statistics for this student",
            "required": ["total_points_earned", "total_points_possible", "percentage"],
            "properties": {
              "total_points_earned": {
                "type": "number",
                "description": "Total points earned",
                "minimum": 0
              },
              "total_points_possible": {
                "type": "number",
                "description": "Total points possible",
                "minimum": 0
              },
              "percentage": {
                "type": "number",
                "description": "Score as percentage (0-100)",
                "minimum": 0,
                "maximum": 100
              },
              "letter_grade": {
                "type": "string",
                "description": "Letter grade (if grading scale applied)",
                "pattern": "^[A-F][+-]?$"
              },
              "questions_correct": {
                "type": "integer",
                "description": "Number of questions answered correctly",
                "minimum": 0
              },
              "questions_incorrect": {
                "type": "integer",
                "description": "Number of questions answered incorrectly",
                "minimum": 0
              },
              "questions_unanswered": {
                "type": "integer",
                "description": "Number of unanswered questions",
                "minimum": 0
              },
              "questions_flagged": {
                "type": "integer",
                "description": "Number of questions flagged for review",
                "minimum": 0
              },
              "average_confidence": {
                "type": "number",
                "description": "Average confidence across all answers",
                "minimum": 0,
                "maximum": 1
              }
            }
          },
          "curved_score": {
            "type": "object",
            "description": "Curved score (enterprise tier)",
            "properties": {
              "curved_percentage": {
                "type": "number",
                "minimum": 0,
                "maximum": 100
              },
              "curved_letter_grade": {
                "type": "string",
                "pattern": "^[A-F][+-]?$"
              },
              "curve_method": {
                "type": "string",
                "enum": ["linear", "bell_curve", "custom"]
              }
            }
          }
        }
      }
    },
    "class_statistics": {
      "type": "object",
      "description": "Class-level statistics (pro/enterprise tier)",
      "properties": {
        "total_students": {
          "type": "integer",
          "description": "Total number of students",
          "minimum": 0
        },
        "mean_score": {
          "type": "number",
          "description": "Mean score (percentage)",
          "minimum": 0,
          "maximum": 100
        },
        "median_score": {
          "type": "number",
          "description": "Median score (percentage)",
          "minimum": 0,
          "maximum": 100
        },
        "std_dev": {
          "type": "number",
          "description": "Standard deviation",
          "minimum": 0
        },
        "min_score": {
          "type": "number",
          "description": "Minimum score (percentage)",
          "minimum": 0,
          "maximum": 100
        },
        "max_score": {
          "type": "number",
          "description": "Maximum score (percentage)",
          "minimum": 0,
          "maximum": 100
        },
        "grade_distribution": {
          "type": "object",
          "description": "Distribution of letter grades",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        },
        "question_analysis": {
          "type": "array",
          "description": "Item analysis for each question (enterprise tier)",
          "items": {
            "type": "object",
            "properties": {
              "question_id": {
                "type": "string"
              },
              "percent_correct": {
                "type": "number",
                "minimum": 0,
                "maximum": 100
              },
              "difficulty": {
                "type": "string",
                "enum": ["very_easy", "easy", "medium", "hard", "very_hard"]
              },
              "discrimination_index": {
                "type": "number",
                "description": "Discrimination index (-1 to 1)",
                "minimum": -1,
                "maximum": 1
              },
              "point_biserial": {
                "type": "number",
                "description": "Point-biserial correlation",
                "minimum": -1,
                "maximum": 1
              }
            }
          }
        }
      }
    },
    "grading_scale": {
      "type": "object",
      "description": "Grading scale used (if applicable)",
      "properties": {
        "A": {
          "type": "object",
          "properties": {
            "min": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "max": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        },
        "B": {
          "type": "object",
          "properties": {
            "min": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "max": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        },
        "C": {
          "type": "object",
          "properties": {
            "min": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "max": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        },
        "D": {
          "type": "object",
          "properties": {
            "min": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "max": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        },
        "F": {
          "type": "object",
          "properties": {
            "min": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "max": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    }
  }
}
